group_by(cnt) %>%
summarise(n=n())
check_item2 <- check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
arrange(cnt, Item.Number) %>%
select(cnt, Item.Number, Item.Description, Description2)
check_item2 %>%
filter(cnt > 1) %>%
sheet_write(out.sheet, sheet = 'Check_item')
check_item2 <- check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(Item.Number, Description2) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
arrange(cnt, Item.Number) %>%
left_join(check_item %>% select(Item.Number, Item.Description))
check_item2 <- check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(Item.Number, Description2) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
arrange(cnt, Item.Number) %>%
left_join(check_item %>% select(Item.Number, Item.Description), by="Item.Number")
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(Item.Number, Description2) %>%
unique() %>% names()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(Item.Number, Description2) %>%
unique() %>%
left_join(check_item %>% select(Item.Number, Item.Description), by="Item.Number") %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>% head()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(-Item.Description) %>%
unique() %>%
select(-Description2) %>%
left_join(check_item %>% select(Item.Number, Item.Description), by="Item.Number") %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>% head()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(-Item.Description) %>% head()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
select(-Description2) %>%
left_join(check_item %>% select(Item.Number, Item.Description), by="Item.Number") %>%
head()
check_item %>% head()
library(googlesheets4)
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
library(multilinguer)
# -----------------------------------------------------------------------------------
# Account Verification
# -----------------------------------------------------------------------------------
# gs4_auth()
2
# -----------------------------------------------------------------------------------
# Account Verification
# -----------------------------------------------------------------------------------
gs4_auth()
wdir <- 'https://docs.google.com/spreadsheets/d/1a1rbVgVJp6n6xd8r7Qxu1WTwo-9n1cnzd_7lk7FX6fM/'
### Data;
setwd("./Data")
load("C:/Users/User/Desktop/R_Data/R_data/Iowa/Data/CHECK POINT2.RData")
check_item <- data2019 %>%
select(Item.Number, Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
arrange(cnt, Item.Number) %>%
select(cnt, Item.Number, Item.Description)
inds_county <-
data2019 %>%
select(County.Number, County) %>%
filter(!is.na(County.Number)) %>%
unique() %>%
arrange(County.Number)
check_item %>% head()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
mutate(Description2 = str_replace_all(Description2, "2020", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2021", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2022", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
select(-Description2) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
left_join(data2019 %>% select(Item.Number, Item.Description), by="Item.Number") %>%
head()
check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
mutate(Description2 = str_replace_all(Description2, "2020", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2021", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2022", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
select(-Description2) %>%
mutate(cnt = n()) %>% head()
###????
check_item2 <- check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
mutate(Description2 = str_replace_all(Description2, "2020", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2021", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2022", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
select(-Description2) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
left_join(data2019 %>% select(Item.Number, Item.Description) %>% unique(), by="Item.Number") %>%
head()
View(check_item2)
View(check_item2)
###????
check_item2 <- check_item %>%
select(Item.Number, Item.Description) %>% unique() %>%
mutate(Description2 = str_replace_all(Item.Description,"[^a-zA-Z0-9]","")) %>%
mutate(Description2 = str_replace_all(Description2, "YR", "YEAR")) %>%
mutate(Description2 = str_replace_all(Description2, "2020", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2021", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2022", "")) %>%
mutate(Description2 = str_replace_all(Description2, "2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
select(-Description2) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
left_join(data2019 %>% select(Item.Number, Item.Description) %>% unique(), by="Item.Number") %>%
unique()
###????
check_item <- data2019 %>%
select(Item.Number, Item.Description) %>%
unique() %>%
mutate(Description2 = str_replace_all(Item.Description, "[^a-zA-Z0-9]", "") %>%
str_replace_all("YR", "YEAR") %>%
str_replace_all("2020|2021|2022|2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
left_join(data2019 %>% select(Item.Number, Item.Description) %>% unique(), by = "Item.Number") %>%
select(Item.Number, Item.Description, cnt) %>%
unique()
check_item %>% head()
###????
check_item <- data2019 %>%
select(Item.Number, Item.Description) %>%
unique() %>%
mutate(Description2 = str_replace_all(Item.Description, "[^a-zA-Z0-9]", "") %>%
str_replace_all("YR", "YEAR") %>%
str_replace_all("2020|2021|2022|2023", "")) %>%
select(-Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
left_join(data2019 %>% distinct(Item.Number, Item.Description), by = "Item.Number") %>%
select(Item.Number, Item.Description, cnt) %>%
unique()
check_item %>%
filter(cnt > 1) %>%
sheet_write(out.sheet, sheet = 'Check_item')
check_item %>%
arrange(cnt, Item.Number)
check_item %>%
arrange(cnt, Item.Number) %>%
sheet_write(out.sheet, sheet = 'Check_item')
data2019 %>%
select(Item.Number, Item.Description) %>%
unique() %>%
group_by(Item.Number) %>%
mutate(cnt = n()) %>%
filter(cnt > 1) %>%
head()
load("C:/Users/User/Desktop/R_Data/R_data/Iowa/Data/CHECK POINT2.RData")
data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
nrow()
library(googlesheets4)
library(tidyverse)
library(dplyr)
library(lubridate)
library(stringr)
library(multilinguer)
# -----------------------------------------------------------------------------------
# Account Verification
# -----------------------------------------------------------------------------------
gs4_auth()
wdir <- 'https://docs.google.com/spreadsheets/d/1a1rbVgVJp6n6xd8r7Qxu1WTwo-9n1cnzd_7lk7FX6fM/'
### Data;
setwd("./Data")
#### final
# inds_store <-
data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
nrow()
#### final
# inds_store <-
check_add <- data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
group_by(Store.Number) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(Store.Number)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
inds_county <-
data2019 %>%
select(County.Number, County) %>%
filter(!is.na(County.Number)) %>%
unique() %>%
arrange(County.Number)
inds_vendor <- data2019 %>%
select(Vendor.Number, Vendor.Name) %>%
unique()
inds_item <- data2019 %>%
select(Item.Number, Item.Description, Date) %>%
arrange(Item.Number, desc(Date)) %>%
group_by(Item.Number) %>% slice(1:1)
wdir_inds <- 'https://docs.google.com/spreadsheets/d/1xZHyQzYe6uEus_39sGXcR9UXz_mrjxnxffrtHzMp3Kk/'
#### Print Inds ####
out.sheet <- gs4_get(wdir_inds)
inds_county %>%
write_sheet(out.sheet,
sheet = 'inds_county')
inds_item %>%
write_sheet(out.sheet,
sheet = 'inds_item')
inds_vendor %>%
write_sheet(out.sheet,
sheet = 'inds_vendor')
#### final
# inds_store <-
check_add <- data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
filter(!is.na(County.Number)) %>%
filter(!is.na(City)) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
group_by(Store.Number) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(Store.Number)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
inds_store <- date2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
filter(!str_equal(County.Number)) %>%
filter(!str_equal(City)) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique()
#### final
check_add <- data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
filter(!str_equal(County.Number)) %>%
filter(!str_equal(City)) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
group_by(Store.Number) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(Store.Number)
#### final
check_add <- data2019 %>%
select(Store.Number, Store.Name, City, County.Number) %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique() %>%
group_by(Store.Number) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(Store.Number)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
View(check_add)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
out.sheet <- gs4_get(wdir)
#### Print Inds ####
out.sheet2 <- gs4_get(wdir_inds)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
inds_store <- data2019 %>%
select(Store.Number, Store.Name, City) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City, "OTUMWA", "OTTUMWA")) %>%
mutate(City = ifelse(Store.Number == 5619, ifelse(City, "EVANSDALE", "ELKRUNHEIGHTS"), City)) %>%
unique()
rm(check_add)
inds_store %>%
arragne(Store.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_store')
inds_store %>%
arrange(Store.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_store')
inds_vendor %>%
arrange(Vendor.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_vendor')
data2019 %>%
select(Store.Number, Store.Name, City) %>%
filter(!str_equal(City, "")) %>% head()
inds_store <- data2019 %>%
select(Store.Number, Store.Name, City) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
mutate(City = ifelse(Store.Number == 5619,
ifelse(City == "EVANSDALE", "ELKRUNHEIGHTS", City), City)) %>%
unique()
inds_store %>%
arrange(Store.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_store')
inds_store %>%
arrange(Store.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_store')
#### Print Inds ####
out.sheet2 <- gs4_get(wdir_inds)
# -----------------------------------------------------------------------------------
# Account Verification
# -----------------------------------------------------------------------------------
gs4_auth()
inds_store %>%
arrange(Store.Number) %>%
write_sheet(out.sheet2,
sheet = 'inds_store')
### Create inds_city
data2019 %>%
select(City, County.Number) %>%
unique() %>% nrow()
### Create inds_city
data2019 %>%
select(City, County.Number) %>%
unique() %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
nrow()
#check city&county -> city 473개
data2019 %>%
select(city) %>% unique() %>% nrow()
#check city&county -> city 473개
data2019 %>%
select(City) %>% unique() %>% nrow()
data2019 %>%
select(City, County.Number) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
filter(!is.na(County.Number)) %>%
unique() %>% nrow() #482
data2019 %>%
select(City, County.Number) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
filter(!is.na(County.Number)) %>%
filter(!is.na(City)) %>%
unique() %>% nrow() #482
data2019 %>%
select(City, County.Number) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
unique() %>% nrow() #482
data2019 %>%
select(City, County.Number) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
group_by(City) %>%
mutate(n = n()) %>%
filter(n > 1)
data2019 %>%
select(City, County.Number) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
unique() %>%
group_by(City) %>%
mutate(n = n()) %>%
filter(n > 1)
#### final
check_add <- data2019 %>%
select(City, County.Number) %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
mutate(City = ifelse(Store.Number == 5619,
ifelse(City == "EVANSDALE", "ELKRUNHEIGHTS", City), City)) %>%
unique() %>%
group_by(City) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(City)
#### final
check_add <- data2019 %>%
select(City, County.Number) %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
unique() %>%
group_by(City) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(City)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
#### final
check_add <- data2019 %>%
select(City, County.Number, County) %>%
filter(!str_equal(County.Number, "")) %>%
filter(!str_equal(City, "")) %>%
unique() %>%
mutate(City = str_replace_all(City, " ", "")) %>%
mutate(City = ifelse(City == "OTUMWA", "OTTUMWA", City)) %>%
unique() %>%
group_by(City) %>%
mutate(n = n()) %>%
filter(n > 1) %>%
arrange(City)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
##### CHECK POINT 3 #####
rm(check_store, check_city, check_address, check_vendor)
check_add %>%
write_sheet(out.sheet,
sheet = 'check_add')
save.image("C:/Users/User/Desktop/R_Data/R_data/Iowa/Data/CHECK POINT 3.RData")
